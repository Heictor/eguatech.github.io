<!doctype html><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Requests - Rocket Programming Guide</title><meta name=description content="Rocket is a web framework for the Rust
      programming language that makes it simple to write fast web applications
      without sacrificing flexibility or type safety."><meta name=author content="Sergio Benitez"><link href="https://fonts.googleapis.com/css?family=Proza+Libre:400,500" rel=stylesheet><link rel=stylesheet href=../../v0-4/css/style.css media=all><link rel=icon type=image/png href=../../v0-4/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../v0-4/images/favicon-16x16.png sizes=16x16><style media=screen>.clouds.back{background:transparent url(../../v0-4/images/clouds-back.png) repeat}.clouds.front{background:transparent url(../../v0-4/images/clouds-front.png) repeat-x}#logo{background-image:url(../../v0-4/images/logo.svg)}@media(max-width:870px){#logo{background-image:url(../../v0-4/images/logo-small.svg)}}input#search-input{background-image:url(../../v0-4/images/search-icon.svg)}.cancel-search{background:url(../../v0-4/images/cancel-icon.svg) no-repeat center}.admonition.note .title{background-image:url(../../v0-4/images/pencil-icon.svg)}.admonition.tip .title{background-image:url(../../v0-4/images/star-icon.svg)}.admonition.warning .title{background-image:url(../../v0-4/images/warning-icon.svg)}</style><header><div class="back clouds"></div><div class="front clouds"></div><div class=container><a id=logo href=../../index.html ><span>Rocket Homepage</span></a><nav class=version-select><span onclick=toggleOptions()>v0.4 <i></i></span><options><a href=../../v0-3.html >v0.3</a></options></nav><input type=checkbox id=toggle> <label for=toggle class=hamburger><span></span> <span></span> <span></span></label><nav class=main><a href=../../v0-4/overview.html>overview</a> <a href=../../v0-4/guide.html>guide</a> <a href=../../api_subdomain/v0-4/rocket.html>api</a> <a href=../../v0-4/news.html>news</a> <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4>code</a></nav><div class=centered><h1><a href=../../v0-4/guide.html>Guide</a></h1><h4>The ins and outs of Rocket, in detail.</h4></div></div></header><section class="grid tight blocky-code"><div id=sidebar><nav><input id=search-input placeholder="Search guide..."><div class=toc><ul class=small><li><a href=../../index.html>Introduction</a></ul><ul class=small><li><a href=../../index.html>Quickstart</a></ul><ul class=small><li><a href=../../index.html>Getting Started</a></ul><ul class=small><li><a href=../../index.html>Overview</a></ul><ul><li><a href=#requests>Requests</a><ul><li><a href=#methods>Methods</a><ul><li><a href=#head-requests>HEAD Requests</a><li><a href=#reinterpreting>Reinterpreting</a></ul><li><a href=#dynamic-paths>Dynamic Paths</a><ul><li><a href=#multiple-segments>Multiple Segments</a></ul><li><a href=#forwarding>Forwarding</a><ul><li><a href=#default-ranking>Default Ranking</a></ul><li><a href=#query-strings>Query Strings</a><ul><li><a href=#optional-parameters>Optional Parameters</a><li><a href=#multiple-segments_1>Multiple Segments</a></ul><li><a href=#request-guards>Request Guards</a><ul><li><a href=#custom-guards>Custom Guards</a><li><a href=#guard-transparency>Guard Transparency</a><li><a href=#forwarding-guards>Forwarding Guards</a></ul><li><a href=#cookies>Cookies</a><ul><li><a href=#private-cookies>Private Cookies</a><li><a href=#secret-key>Secret Key</a><li><a href=#one-at-a-time>One-At-A-Time</a></ul><li><a href=#format>Format</a><li><a href=#body-data>Body Data</a><ul><li><a href=#forms>Forms</a><ul><li><a href=#lenient-parsing>Lenient Parsing</a><li><a href=#field-renaming>Field Renaming</a><li><a href=#field-validation>Field Validation</a></ul><li><a href=#json>JSON</a><li><a href=#streaming>Streaming</a></ul><li><a href=#error-catchers>Error Catchers</a></ul></ul><ul class=small><li><a href=../../v0-4/guide/responses.html>Responses</a></ul><ul class=small><li><a href=../../index.html>State</a></ul><ul class=small><li><a href=../../index.html>Fairings</a></ul><ul class=small><li><a href=../../v0-4/guide/testing.html>Testing</a></ul><ul class=small><li><a href=../../v0-4/guide/configuration.html>Configuration</a></ul><ul class=small><li><a href=../../index.html>Pastebin</a></ul><ul class=small><li><a href=../../index.html>Conclusion</a></ul></div></nav></div><article><h2 id=requests>Requests<a class=headerlink href=#requests title="perma link">#</a></h2><p>Together, a <a href=../../index.html><code>route</code></a> attribute and function signature specify what must be true about a request in order for the route's handler to be called. You've already seen an example of this in action:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/world"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>handler</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>This route indicates that it only matches against <code>GET</code> requests to the <code>/world</code> route. Rocket ensures that this is the case before <code>handler</code> is called. Of course, you can do much more than specify the method and path of a request. Among other things, you can ask Rocket to automatically validate:<ul><li>The type of a dynamic path segment.<li>The type of <em>several</em> dynamic path segments.<li>The type of incoming body data.<li>The types of query strings, forms, and form values.<li>The expected incoming or outgoing format of a request.<li>Any arbitrary, user-defined security or validation policies.</ul><p>The route attribute and function signature work in tandem to describe these validations. Rocket's code generation takes care of actually validating the properties. This section describes how to ask Rocket to validate against all of these properties and more.<h3 id=methods>Methods<a class=headerlink href=#methods title="perma link">#</a></h3><p>A Rocket route attribute can be any one of <code>get</code>, <code>put</code>, <code>post</code>, <code>delete</code>, <code>head</code>, <code>patch</code>, or <code>options</code>, each corresponding to the HTTP method to match against. For example, the following attribute will match against <code>POST</code> requests to the root path:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[post(</span><span class=s>"/"</span><span class=cp>)]</span><span class=w></span>
</pre></div></table><p>The grammar for these attributes is defined formally in the <a href=../../index.html><code>rocket_codegen</code></a> API docs.<h4 id=head-requests>HEAD Requests<a class=headerlink href=#head-requests title="perma link">#</a></h4><p>Rocket handles <code>HEAD</code> requests automatically when there exists a <code>GET</code> route that would otherwise match. It does this by stripping the body from the response, if there is one. You can also specialize the handling of a <code>HEAD</code> request by declaring a route for it; Rocket won't interfere with <code>HEAD</code> requests your application explicitly handles.<h4 id=reinterpreting>Reinterpreting<a class=headerlink href=#reinterpreting title="perma link">#</a></h4><p>Because HTML forms can only be directly submitted as <code>GET</code> or <code>POST</code> requests, Rocket <em>reinterprets</em> request methods under certain conditions. If a <code>POST</code> request contains a body of <code>Content-Type: application/x-www-form-urlencoded</code> and the form's <strong>first</strong> field has the name <code>_method</code> and a valid HTTP method name as its value (such as <code>"PUT"</code>), that field's value is used as the method for the incoming request. This allows Rocket applications to submit non-<code>POST</code> forms. The <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/todo/static/index.html.tera#L47>todo example</a> makes use of this feature to submit <code>PUT</code> and <code>DELETE</code> requests from a web form.<h3 id=dynamic-paths>Dynamic Paths<a class=headerlink href=#dynamic-paths title="perma link">#</a></h3><p>You can declare path segments as dynamic by using angle brackets around variable names in a route's path. For example, if we want to say <em>Hello!</em> to anything, not just the world, we can declare a route like so:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/hello/&lt;name>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=n>name</span>: <span class=kp>&</span><span class=nc>RawStr</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"Hello, {}!"</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=n>as_str</span><span class=p>())</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>If we were to mount the path at the root (<code>.mount("/", routes![hello])</code>), then any request to a path with two non-empty segments, where the first segment is <code>hello</code>, will be dispatched to the <code>hello</code> route. For example, if we were to visit <code>/hello/John</code>, the application would respond with <code>Hello, John!</code>.<p>Any number of dynamic path segments are allowed. A path segment can be of any type, including your own, as long as the type implements the <a href=../../index.html><code>FromParam</code></a> trait. We call these types <em>parameter guards</em>. Rocket implements <code>FromParam</code> for many of the standard library types, as well as a few special Rocket types. For the full list of provided implementations, see the <a href=../../index.html><code>FromParam</code> API docs</a>. Here's a more complete route to illustrate varied usage:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/hello/&lt;name>/&lt;age>/&lt;cool>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=n>name</span>: <span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>age</span>: <span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=n>cool</span>: <span class=kt>bool</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>cool</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"You're a cool {} year old, {}!"</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"{}, we need to talk about your coolness."</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><div class="admonition note"><span class=title><b>Note:</b> Rocket types <em>raw</em> strings separately from decoded strings.</span><p>You may have noticed an unfamiliar <a href=../../index.html><code>RawStr</code></a> type in the code example above. This is a special type, provided by Rocket, that represents an unsanitized, unvalidated, and undecoded raw string from an HTTP message. It exists to separate validated string inputs, represented by types such as <code>String</code>, <code>&str</code>, and <code>Cow&lt;str></code>, from unvalidated inputs, represented by <code>&RawStr</code>. It also provides helpful methods to convert the unvalidated string into a validated one.<p>Because <code>&RawStr</code> implements <a href=../../index.html><code>FromParam</code></a>, it can be used as the type of a dynamic segment, as in the example above, where the value refers to a potentially undecoded string. By contrast, a <code>String</code> is guaranteed to be decoded. Which you should use depends on whether you want direct but potentially unsafe access to the string (<code>&RawStr</code>), or safe access to the string at the cost of an allocation (<code>String</code>).</div><h4 id=multiple-segments>Multiple Segments<a class=headerlink href=#multiple-segments title="perma link">#</a></h4><p>You can also match against multiple segments by using <code>&lt;param..></code> in a route path. The type of such parameters, known as <em>segments guards</em>, must implement <a href=../../index.html><code>FromSegments</code></a>. A segments guard must be the final component of a path: any text after a segments guard will result in a compile-time error.<p>As an example, the following route matches against all paths that begin with <code>/page/</code>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>path</span>::<span class=n>PathBuf</span><span class=p>;</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/page/&lt;path..>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>get_page</span><span class=p>(</span><span class=n>path</span>: <span class=nc>PathBuf</span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The path after <code>/page/</code> will be available in the <code>path</code> parameter. The <code>FromSegments</code> implementation for <code>PathBuf</code> ensures that <code>path</code> cannot lead to <a href=https://www.owasp.org/index.php/Path_Traversal>path traversal attacks</a>. With this, a safe and secure static file server can be implemented in 4 lines:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/&lt;file..>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>files</span><span class=p>(</span><span class=n>file</span>: <span class=nc>PathBuf</span><span class=p>)</span><span class=w> </span>-> <span class=nb>Option</span><span class=o>&lt;</span><span class=n>NamedFile</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>NamedFile</span>::<span class=n>open</span><span class=p>(</span><span class=n>Path</span>::<span class=n>new</span><span class=p>(</span><span class=s>"static/"</span><span class=p>).</span><span class=n>join</span><span class=p>(</span><span class=n>file</span><span class=p>)).</span><span class=n>ok</span><span class=p>()</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><div class="admonition tip"><span class=title><b>Tip:</b> Rocket makes it even <em>easier</em> to serve static files!</span><p>If you need to serve static files from your Rocket application, consider using the <a href=../../index.html><code>StaticFiles</code></a> custom handler from <a href=../../index.html ><code>rocket_contrib</code></a>, which makes it as simple as:<p><code>rocket.mount("/public", StaticFiles::from("/static"))</code></div><h3 id=forwarding>Forwarding<a class=headerlink href=#forwarding title="perma link">#</a></h3><p>Let's take a closer look at the route attribute and signature pair from a previous example:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/hello/&lt;name>/&lt;age>/&lt;cool>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=n>name</span>: <span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>age</span>: <span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=n>cool</span>: <span class=kt>bool</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>What if <code>cool</code> isn't a <code>bool</code>? Or, what if <code>age</code> isn't a <code>u8</code>? When a parameter type mismatch occurs, Rocket <em>forwards</em> the request to the next matching route, if there is any. This continues until a route doesn't forward the request or there are no remaining routes to try. When there are no remaining routes, a customizable <strong>404 error</strong> is returned.<p>Routes are attempted in increasing <em>rank</em> order. Rocket chooses a default ranking from -6 to -1, detailed in the next section, but a route's rank can also be manually set with the <code>rank</code> attribute. To illustrate, consider the following routes:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/user/&lt;id>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>user</span><span class=p>(</span><span class=n>id</span>: <span class=kt>usize</span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/user/&lt;id>"</span><span class=cp>, rank = 2)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>user_int</span><span class=p>(</span><span class=n>id</span>: <span class=kt>isize</span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/user/&lt;id>"</span><span class=cp>, rank = 3)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>user_str</span><span class=p>(</span><span class=n>id</span>: <span class=kp>&</span><span class=nc>RawStr</span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>rocket</span>::<span class=n>ignite</span><span class=p>()</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>mount</span><span class=p>(</span><span class=s>"/"</span><span class=p>,</span><span class=w> </span><span class=n>routes</span><span class=o>!</span><span class=p>[</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>user_int</span><span class=p>,</span><span class=w> </span><span class=n>user_str</span><span class=p>])</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>launch</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>Notice the <code>rank</code> parameters in <code>user_int</code> and <code>user_str</code>. If we run this application with the routes mounted at the root path, as is done in <code>main</code> above, requests to <code>/user/&lt;id></code> (such as <code>/user/123</code>, <code>/user/Bob</code>, and so on) will be routed as follows:<ol><li><p>The <code>user</code> route matches first. If the string at the <code>&lt;id></code> position is an unsigned integer, then the <code>user</code> handler is called. If it is not, then the request is forwarded to the next matching route: <code>user_int</code>.<li><p>The <code>user_int</code> route matches next. If <code>&lt;id></code> is a signed integer, <code>user_int</code> is called. Otherwise, the request is forwarded.<li><p>The <code>user_str</code> route matches last. Since <code>&lt;id></code> is a always string, the route always matches. The <code>user_str</code> handler is called.</ol><div class="admonition note"><span class=title><b>Note:</b> A route's rank appears in <strong>[brackets]</strong> during launch.</span><p>You'll also find a route's rank logged in brackets during application launch: <code>GET /user/&lt;id> [3] (user_str)</code>.</div><p>Forwards can be <em>caught</em> by using a <code>Result</code> or <code>Option</code> type. For example, if the type of <code>id</code> in the <code>user</code> function was <code>Result&lt;usize, &RawStr></code>, then <code>user</code> would never forward. An <code>Ok</code> variant would indicate that <code>&lt;id></code> was a valid <code>usize</code>, while an <code>Err</code> would indicate that <code>&lt;id></code> was not a <code>usize</code>. The <code>Err</code>'s value would contain the string that failed to parse as a <code>usize</code>.<div class="admonition tip"><span class=title><b>Tip:</b> It's not just forwards that can be caught!</span><p>In general, when any guard fails for any reason, including parameter guards, you can use an <code>Option</code> or <code>Result</code> type in its place to catch the failure.</div><p>By the way, if you were to omit the <code>rank</code> parameter in the <code>user_str</code> or <code>user_int</code> routes, Rocket would emit an error and abort launch, indicating that the routes <em>collide</em>, or can match against similar incoming requests. The <code>rank</code> parameter resolves this collision.<h4 id=default-ranking>Default Ranking<a class=headerlink href=#default-ranking title="perma link">#</a></h4><p>If a rank is not explicitly specified, Rocket assigns a default ranking. By default, routes with static paths and query strings have lower ranks (higher precedence) while routes with dynamic paths and without query strings have higher ranks (lower precedence). The table below describes the default ranking of a route given its properties.<div class=table-container><table><thead><tr><th>static path<th>query<th>rank<th>example<tbody><tr><td>yes<td>partly static<td>-6<td><code>/hello?world=true</code><tr><td>yes<td>fully dynamic<td>-5<td><code>/hello/?&lt;world></code><tr><td>yes<td>none<td>-4<td><code>/hello</code><tr><td>no<td>partly static<td>-3<td><code>/&lt;hi>?world=true</code><tr><td>no<td>fully dynamic<td>-2<td><code>/&lt;hi>?&lt;world></code><tr><td>no<td>none<td>-1<td><code>/&lt;hi></code></table></div><h3 id=query-strings>Query Strings<a class=headerlink href=#query-strings title="perma link">#</a></h3><p>Query segments can be declared static or dynamic in much the same way as path segments:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/hello?wave&&lt;name>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=n>name</span>: <span class=kp>&</span><span class=nc>RawStr</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"Hello, {}!"</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=n>as_str</span><span class=p>())</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>The <code>hello</code> route above matches any <code>GET</code> request to <code>/hello</code> that has at least one query key of <code>name</code> and a query segment of <code>wave</code> in any order, ignoring any extra query segments. The value of the <code>name</code> query parameter is used as the value of the <code>name</code> function argument. For instance, a request to <code>/hello?wave&name=John</code> would return <code>Hello, John!</code>. Other requests that would result in the same response include:<ul><li><code>/hello?name=John&wave</code> (reordered)<li><code>/hello?name=John&wave&id=123</code> (extra segments)<li><code>/hello?id=123&name=John&wave</code> (reordered, extra segments)<li><code>/hello?name=Bob&name=John&wave</code> (last value taken)</ul><p>Any number of dynamic query segments are allowed. A query segment can be of any type, including your own, as long as the type implements the <a href=../../index.html><code>FromFormValue</code></a> trait.<h4 id=optional-parameters>Optional Parameters<a class=headerlink href=#optional-parameters title="perma link">#</a></h4><p>Query parameters are allowed to be <em>missing</em>. As long as a request's query string contains all of the static components of a route's query string, the request will be routed to that route. This allows for optional parameters, validating even when a parameter is missing.<p>To achieve this, use <code>Option&lt;T></code> as the parameter type. Whenever the query parameter is missing in a request, <code>None</code> will be provided as the value. A route using <code>Option&lt;T></code> looks as follows:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/hello?wave&&lt;name>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=n>name</span>: <span class=nb>Option</span><span class=o>&lt;&</span><span class=n>RawStr</span><span class=o>></span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>name</span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>name</span><span class=o>|</span><span class=w> </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"Hi, {}!"</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>))</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>unwrap_or_else</span><span class=p>(</span><span class=o>||</span><span class=w> </span><span class=s>"Hello!"</span><span class=p>.</span><span class=n>into</span><span class=p>())</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>Any <code>GET</code> request with a path of <code>/hello</code> and a <code>wave</code> query segment will be routed to this route. If a <code>name=value</code> query segment is present, the route returns the string <code>"Hi, value!"</code>. If no <code>name</code> query segment is present, the route returns <code>"Hello!"</code>.<p>Just like a parameter of type <code>Option&lt;T></code> will have the value <code>None</code> if the parameter is missing from a query, a parameter of type <code>bool</code> will have the value <code>false</code> if it is missing. The default value for a missing parameter can be customized for your own types that implement <code>FromFormValue</code> by implementing <a href=../../index.html#method.default><code>FromFormValue::default()</code></a>.<h4 id=multiple-segments_1>Multiple Segments<a class=headerlink href=#multiple-segments_1 title="perma link">#</a></h4><p>As with paths, you can also match against multiple segments in a query by using <code>&lt;param..></code>. The type of such parameters, known as <em>query guards</em>, must implement the <a href=../../index.html><code>FromQuery</code></a> trait. Query guards must be the final component of a query: any text after a query parameter will result in a compile-time error.<p>A query guard validates all otherwise unmatched (by static or dynamic query parameters) query segments. While you can implement <a href=../../index.html><code>FromQuery</code></a> yourself, most use cases will be handled by using the <a href=../../index.html><code>Form</code></a> or <a href=../../index.html><code>LenientForm</code></a> query guard. The <a href=#forms>Forms</a> section explains using these types in detail. In short, these types allow you to use a structure with named fields to automatically validate query/form parameters:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>use</span><span class=w> </span><span class=n>rocket</span>::<span class=n>request</span>::<span class=n>Form</span><span class=p>;</span><span class=w></span>
<span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>name</span>: <span class=nb>String</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>account</span>: <span class=kt>usize</span><span class=p>,</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/item?&lt;id>&&lt;user..>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>item</span><span class=p>(</span><span class=n>id</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>user</span>: <span class=nc>Form</span><span class=o>&lt;</span><span class=n>User</span><span class=o>></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>For a request to <code>/item?id=100&name=sandal&account=400</code>, the <code>item</code> route above sets <code>id</code> to <code>100</code> and <code>user</code> to <code>User { name: "sandal", account: 400 }</code>. To catch forms that fail to validate, use a type of <code>Option</code> or <code>Result</code>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/item?&lt;id>&&lt;user..>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>item</span><span class=p>(</span><span class=n>id</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>user</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Form</span><span class=o>&lt;</span><span class=n>User</span><span class=o>>></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>For more query handling examples, see <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/query_params>the <code>query_params</code> example</a>.<h3 id=request-guards>Request Guards<a class=headerlink href=#request-guards title="perma link">#</a></h3><p>Request guards are one of Rocket's most powerful instruments. As the name might imply, a request guard protects a handler from being called erroneously based on information contained in an incoming request. More specifically, a request guard is a type that represents an arbitrary validation policy. The validation policy is implemented through the <a href=../../index.html><code>FromRequest</code></a> trait. Every type that implements <code>FromRequest</code> is a request guard.<p>Request guards appear as inputs to handlers. An arbitrary number of request guards can appear as arguments in a route handler. Rocket will automatically invoke the <a href=../../index.html><code>FromRequest</code></a> implementation for request guards before calling the handler. Rocket only dispatches requests to a handler when all of its guards pass.<p>For instance, the following dummy handler makes use of three request guards, <code>A</code>, <code>B</code>, and <code>C</code>. An input can be identified as a request guard if it is not named in the route attribute.<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/&lt;param>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>index</span><span class=p>(</span><span class=n>param</span>: <span class=kt>isize</span><span class=p>,</span><span class=w> </span><span class=n>a</span>: <span class=nc>A</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=nc>B</span><span class=p>,</span><span class=w> </span><span class=n>c</span>: <span class=nc>C</span><span class=p>)</span><span class=w> </span>-> <span class=p>...</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>Request guards always fire in left-to-right declaration order. In the example above, the order will be <code>A</code> followed by <code>B</code> followed by <code>C</code>. Failure is short-circuiting; if one guard fails, the remaining are not attempted. To learn more about request guards and implementing them, see the <a href=../../index.html><code>FromRequest</code></a> documentation.<h4 id=custom-guards>Custom Guards<a class=headerlink href=#custom-guards title="perma link">#</a></h4><p>You can implement <code>FromRequest</code> for your own types. For instance, to protect a <code>sensitive</code> route from running unless an <code>ApiKey</code> is present in the request headers, you might create an <code>ApiKey</code> type that implements <code>FromRequest</code> and then use it as a request guard:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/sensitive"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>sensitive</span><span class=p>(</span><span class=n>key</span>: <span class=nc>ApiKey</span><span class=p>)</span><span class=w> </span>-> <span class=kp>&</span><span class=nb>'static</span><span class=w> </span><span class=kt>str</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>You might also implement <code>FromRequest</code> for an <code>AdminUser</code> type that authenticates an administrator using incoming cookies. Then, any handler with an <code>AdminUser</code> or <code>ApiKey</code> type in its argument list is assured to only be invoked if the appropriate conditions are met. Request guards centralize policies, resulting in a simpler, safer, and more secure applications.<h4 id=guard-transparency>Guard Transparency<a class=headerlink href=#guard-transparency title="perma link">#</a></h4><p>When a request guard type can only be created through its <a href=../../index.html><code>FromRequest</code></a> implementation, and the type is not <code>Copy</code>, the existence of a request guard value provides a <em>type-level proof</em> that the current request has been validated against an arbitrary policy. This provides powerful means of protecting your application against access-control violations by requiring data accessing methods to <em>witness</em> a proof of authorization via a request guard. We call the notion of using a request guard as a witness <em>guard transparency</em>.<p>As a concrete example, the following application has a function, <code>health_records</code>, that returns all of the health records in a database. Because health records are sensitive information, they should only be accessible by super users. The <code>SuperUser</code> request guard authenticates and authorizes a super user, and its <code>FromRequest</code> implementation is the only means by which a <code>SuperUser</code> can be constructed. By declaring the <code>health_records</code> function as follows, access control violations against health records are guaranteed to be prevented at <em>compile-time</em>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>fn</span> <span class=nf>health_records</span><span class=p>(</span><span class=n>user</span>: <span class=kp>&</span><span class=nc>SuperUser</span><span class=p>)</span><span class=w> </span>-> <span class=nc>Records</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The reasoning is as follows:<ol><li>The <code>health_records</code> function requires an <code>&SuperUser</code> type.<li>The only constructor for a <code>SuperUser</code> type is <code>FromRequest</code>.<li>Only Rocket can provide an active <code>&Request</code> to construct via <code>FromRequest</code>.<li>Thus, there must be a <code>Request</code> authorizing a <code>SuperUser</code> to call <code>health_records</code>.</ol><div class="admonition note"><span class=title><b>Note</b></span><p>At the expense of a lifetime parameter in the guard type, guarantees can be made even stronger by tying the lifetime of the <code>Request</code> passed to <code>FromRequest</code> to the request guard, ensuring that the guard value always corresponds to an <em>active</em> request.</div><p>We recommend leveraging request guard transparency for <em>all</em> data accesses.<h4 id=forwarding-guards>Forwarding Guards<a class=headerlink href=#forwarding-guards title="perma link">#</a></h4><p>Request guards and forwarding are a powerful combination for enforcing policies. To illustrate, we consider how a simple authorization system might be implemented using these mechanisms.<p>We start with two request guards:<ul><li><p><code>User</code>: A regular, authenticated user.<p>The <code>FromRequest</code> implementation for <code>User</code> checks that a cookie identifies a user and returns a <code>User</code> value if so. If no user can be authenticated, the guard forwards.<li><p><code>AdminUser</code>: A user authenticated as an administrator.<p>The <code>FromRequest</code> implementation for <code>AdminUser</code> checks that a cookie identifies an <em>administrative</em> user and returns an <code>AdminUser</code> value if so. If no user can be authenticated, the guard forwards.</ul><p>We now use these two guards in combination with forwarding to implement the following three routes, each leading to an administrative control panel at <code>/admin</code>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/admin"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>admin_panel</span><span class=p>(</span><span class=n>admin</span>: <span class=nc>AdminUser</span><span class=p>)</span><span class=w> </span>-> <span class=kp>&</span><span class=nb>'static</span><span class=w> </span><span class=kt>str</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=s>"Hello, administrator. This is the admin panel!"</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/admin"</span><span class=cp>, rank = 2)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>admin_panel_user</span><span class=p>(</span><span class=n>user</span>: <span class=nc>User</span><span class=p>)</span><span class=w> </span>-> <span class=kp>&</span><span class=nb>'static</span><span class=w> </span><span class=kt>str</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=s>"Sorry, you must be an administrator to access this page."</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/admin"</span><span class=cp>, rank = 3)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>admin_panel_redirect</span><span class=p>()</span><span class=w> </span>-> <span class=nc>Redirect</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Redirect</span>::<span class=n>to</span><span class=p>(</span><span class=s>"/login"</span><span class=p>)</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>The three routes above encode authentication <em>and</em> authorization. The <code>admin_panel</code> route only succeeds if an administrator is logged in. Only then is the admin panel displayed. If the user is not an admin, the <code>AdminUser</code> guard will forward. Since the <code>admin_panel_user</code> route is ranked next highest, it is attempted next. This route succeeds if there is <em>any</em> user signed in, and an authorization failure message is displayed. Finally, if a user isn't signed in, the <code>admin_panel_redirect</code> route is attempted. Since this route has no guards, it always succeeds. The user is redirected to a log in page.<h3 id=cookies>Cookies<a class=headerlink href=#cookies title="perma link">#</a></h3><p><a href=../../index.html><code>Cookies</code></a> is an important, built-in request guard: it allows you to get, set, and remove cookies. Because <code>Cookies</code> is a request guard, an argument of its type can simply be added to a handler:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>use</span><span class=w> </span><span class=n>rocket</span>::<span class=n>http</span>::<span class=n>Cookies</span><span class=p>;</span><span class=w></span>
<span class=cp>#[get(</span><span class=s>"/"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>index</span><span class=p>(</span><span class=n>cookies</span>: <span class=nc>Cookies</span><span class=p>)</span><span class=w> </span>-> <span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>cookies</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=s>"message"</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>value</span><span class=o>|</span><span class=w> </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"Message: {}"</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>))</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>This results in the incoming request's cookies being accessible from the handler. The example above retrieves a cookie named <code>message</code>. Cookies can also be set and removed using the <code>Cookies</code> guard. The <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/cookies>cookies example</a> on GitHub illustrates further use of the <code>Cookies</code> type to get and set cookies, while the <a href=../../index.html><code>Cookies</code></a> documentation contains complete usage information.<h4 id=private-cookies>Private Cookies<a class=headerlink href=#private-cookies title="perma link">#</a></h4><p>Cookies added via the <a href=../../index.html#method.add><code>Cookies::add()</code></a> method are set <em>in the clear.</em> In other words, the value set is visible by the client. For sensitive data, Rocket provides <em>private</em> cookies.<p>Private cookies are just like regular cookies except that they are encrypted using authenticated encryption, a form of encryption which simultaneously provides confidentiality, integrity, and authenticity. This means that private cookies cannot be inspected, tampered with, or manufactured by clients. If you prefer, you can think of private cookies as being signed and encrypted.<p>The API for retrieving, adding, and removing private cookies is identical except methods are suffixed with <code>_private</code>. These methods are: <a href=../../index.html#method.get_private><code>get_private</code></a>, <a href=../../index.html#method.add_private><code>add_private</code></a>, and <a href=../../index.html#method.remove_private><code>remove_private</code></a>. An example of their usage is below:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div><td class=code><div class="code hl"><pre><span></span><span class=sd>/// Retrieve the user's ID, if any.</span>
<span class=cp>#[get(</span><span class=s>"/user_id"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>user_id</span><span class=p>(</span><span class=n>cookies</span>: <span class=nc>Cookies</span><span class=p>)</span><span class=w> </span>-> <span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>cookies</span><span class=p>.</span><span class=n>get_private</span><span class=p>(</span><span class=s>"user_id"</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>cookie</span><span class=o>|</span><span class=w> </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"User ID: {}"</span><span class=p>,</span><span class=w> </span><span class=n>cookie</span><span class=p>.</span><span class=n>value</span><span class=p>()))</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=sd>/// Remove the `user_id` cookie.</span>
<span class=cp>#[post(</span><span class=s>"/logout"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>logout</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>cookies</span>: <span class=nc>Cookies</span><span class=p>)</span><span class=w> </span>-> <span class=nc>Flash</span><span class=o>&lt;</span><span class=n>Redirect</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>cookies</span><span class=p>.</span><span class=n>remove_private</span><span class=p>(</span><span class=n>Cookie</span>::<span class=n>named</span><span class=p>(</span><span class=s>"user_id"</span><span class=p>));</span><span class=w></span>
<span class=w>    </span><span class=n>Flash</span>::<span class=n>success</span><span class=p>(</span><span class=n>Redirect</span>::<span class=n>to</span><span class=p>(</span><span class=s>"/"</span><span class=p>),</span><span class=w> </span><span class=s>"Successfully logged out."</span><span class=p>)</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>Support for private cookies, which depends on the <a href=https://github.com/briansmith/ring><code>ring</code></a> library, can be omitted at build time by disabling Rocket's default features, in-turn disabling the default <code>private-cookies</code> feature. To do so, modify your <code>Cargo.toml</code> file so that you depend on <code>rocket</code> as follows:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>[dependencies]</span>
<span class=na>rocket</span> <span class=o>=</span> <span class=s>{ version = "0.4.2", default-features = false }</span>
</pre></div></table><h4 id=secret-key>Secret Key<a class=headerlink href=#secret-key title="perma link">#</a></h4><p>To encrypt private cookies, Rocket uses the 256-bit key specified in the <code>secret_key</code> configuration parameter. If one is not specified, Rocket will automatically generate a fresh key. Note, however, that a private cookie can only be decrypted with the same key with which it was encrypted. As such, it is important to set a <code>secret_key</code> configuration parameter when using private cookies so that cookies decrypt properly after an application restart. Rocket emits a warning if an application is run in production without a configured <code>secret_key</code>.<p>Generating a string suitable for use as a <code>secret_key</code> configuration value is usually done through tools like <code>openssl</code>. Using <code>openssl</code>, a 256-bit base64 key can be generated with the command <code>openssl rand -base64 32</code>.<p>For more information on configuration, see the <a href=../../v0-4/guide/configuration.html>Configuration</a> section of the guide.<h4 id=one-at-a-time>One-At-A-Time<a class=headerlink href=#one-at-a-time title="perma link">#</a></h4><p>For safety reasons, Rocket currently requires that at most one <code>Cookies</code> instance be active at a time. It's uncommon to run into this restriction, but it can be confusing to handle if it does crop up.<p>If this does happen, Rocket will emit messages to the console that look as follows:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class="code hl"><pre><span></span>=> Error: Multiple `Cookies` instances are active at once.
=> An instance of `Cookies` must be dropped before another can be retrieved.
=> Warning: The retrieved `Cookies` instance will be empty.
</pre></div></table><p>The messages will be emitted when a violating handler is called. The issue can be resolved by ensuring that two instances of <code>Cookies</code> cannot be active at once due to the offending handler. A common error is to have a handler that uses a <code>Cookies</code> request guard as well as a <code>Custom</code> request guard that retrieves <code>Cookies</code>, as so:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>bad</span><span class=p>(</span><span class=n>cookies</span>: <span class=nc>Cookies</span><span class=p>,</span><span class=w> </span><span class=n>custom</span>: <span class=nc>Custom</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>Because the <code>cookies</code> guard will fire before the <code>custom</code> guard, the <code>custom</code> guard will retrieve an instance of <code>Cookies</code> when one already exists for <code>cookies</code>. This scenario can be fixed by simply swapping the order of the guards:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>good</span><span class=p>(</span><span class=n>custom</span>: <span class=nc>Custom</span><span class=p>,</span><span class=w> </span><span class=n>cookies</span>: <span class=nc>Cookies</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><h3 id=format>Format<a class=headerlink href=#format title="perma link">#</a></h3><p>A route can specify the data format it is willing to accept or respond with by using the <code>format</code> route parameter. The value of the parameter is a string identifying an HTTP media type or a shorthand variant. For instance, for JSON data, the string <code>application/json</code> or simply <code>json</code> can be used.<p>When a route indicates a payload-supporting method (<code>PUT</code>, <code>POST</code>, <code>DELETE</code>, and <code>PATCH</code>), the <code>format</code> route parameter instructs Rocket to check against the <code>Content-Type</code> header of the incoming request. Only requests where the <code>Content-Type</code> header matches the <code>format</code> parameter will match to the route.<p>As an example, consider the following route:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[post(</span><span class=s>"/user"</span><span class=cp>, format = </span><span class=s>"application/json"</span><span class=cp>, data = </span><span class=s>"&lt;user>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new_user</span><span class=p>(</span><span class=n>user</span>: <span class=nc>Json</span><span class=o>&lt;</span><span class=n>User</span><span class=o>></span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The <code>format</code> parameter in the <code>post</code> attribute declares that only incoming requests with <code>Content-Type: application/json</code> will match <code>new_user</code>. (The <code>data</code> parameter is described in the next section.) Shorthand is also supported for the most common <code>format</code> arguments. Instead of using the full Content-Type, <code>format = "application/json"</code>, you can also write shorthands like <code>format = "json"</code>. For a full list of available shorthands, see the <a href=../../index.html#method.parse_flexible><code>ContentType::parse_flexible()</code></a> documentation.<p>When a route indicates a non-payload-supporting method (<code>HEAD</code>, <code>OPTIONS</code>, and, these purposes, <code>GET</code>) the <code>format</code> route parameter instructs Rocket to check against the <code>Accept</code> header of the incoming request. Only requests where the preferred media type in the <code>Accept</code> header matches the <code>format</code> parameter will match to the route.<p>As an example, consider the following route:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[get(</span><span class=s>"/user/&lt;id>"</span><span class=cp>, format = </span><span class=s>"json"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>user</span><span class=p>(</span><span class=n>id</span>: <span class=kt>usize</span><span class=p>)</span><span class=w> </span>-> <span class=nc>Json</span><span class=o>&lt;</span><span class=n>User</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The <code>format</code> parameter in the <code>get</code> attribute declares that only incoming requests with <code>application/json</code> as the preferred media type in the <code>Accept</code> header will match <code>user</code>. If instead the route had been declared as <code>post</code>, Rocket would match the <code>format</code> against the <code>Content-Type</code> header of the incoming response.<h3 id=body-data>Body Data<a class=headerlink href=#body-data title="perma link">#</a></h3><p>Body data processing, like much of Rocket, is type directed. To indicate that a handler expects body data, annotate it with <code>data = "&lt;param>"</code>, where <code>param</code> is an argument in the handler. The argument's type must implement the <a href=../../index.html><code>FromData</code></a> trait. It looks like this, where <code>T</code> is assumed to implement <code>FromData</code>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[post(</span><span class=s>"/"</span><span class=cp>, data = </span><span class=s>"&lt;input>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>input</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>Any type that implements <a href=../../index.html><code>FromData</code></a> is also known as <em>data guard</em>.<h4 id=forms>Forms<a class=headerlink href=#forms title="perma link">#</a></h4><p>Forms are one of the most common types of data handled in web applications, and Rocket makes handling them easy. Say your application is processing a form submission for a new todo <code>Task</code>. The form contains two fields: <code>complete</code>, a checkbox, and <code>description</code>, a text field. You can easily handle the form request in Rocket as follows:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>Task</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>complete</span>: <span class=kt>bool</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>description</span>: <span class=nb>String</span><span class=p>,</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[post(</span><span class=s>"/todo"</span><span class=cp>, data = </span><span class=s>"&lt;task>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>task</span>: <span class=nc>Form</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>></span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The <a href=../../index.html><code>Form</code></a> type implements the <code>FromData</code> trait as long as its generic parameter implements the <a href=../../index.html><code>FromForm</code></a> trait. In the example, we've derived the <code>FromForm</code> trait automatically for the <code>Task</code> structure. <code>FromForm</code> can be derived for any structure whose fields implement <a href=../../index.html><code>FromFormValue</code></a>. If a <code>POST /todo</code> request arrives, the form data will automatically be parsed into the <code>Task</code> structure. If the data that arrives isn't of the correct Content-Type, the request is forwarded. If the data doesn't parse or is simply invalid, a customizable <code>400 - Bad Request</code> or <code>422 - Unprocessable Entity</code> error is returned. As before, a forward or failure can be caught by using the <code>Option</code> and <code>Result</code> types:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[post(</span><span class=s>"/todo"</span><span class=cp>, data = </span><span class=s>"&lt;task>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>task</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Form</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>>></span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><h5 id=lenient-parsing>Lenient Parsing<a class=headerlink href=#lenient-parsing title="perma link">#</a></h5><p>Rocket's <code>FromForm</code> parsing is <em>strict</em> by default. In other words, A <code>Form&lt;T></code> will parse successfully from an incoming form only if the form contains the exact set of fields in <code>T</code>. Said another way, a <code>Form&lt;T></code> will error on missing and/or extra fields. For instance, if an incoming form contains the fields "a", "b", and "c" while <code>T</code> only contains "a" and "c", the form <em>will not</em> parse as <code>Form&lt;T></code>.<p>Rocket allows you to opt-out of this behavior via the <a href=../../index.html><code>LenientForm</code></a> data type. A <code>LenientForm&lt;T></code> will parse successfully from an incoming form as long as the form contains a superset of the fields in <code>T</code>. Said another way, a <code>LenientForm&lt;T></code> automatically discards extra fields without error. For instance, if an incoming form contains the fields "a", "b", and "c" while <code>T</code> only contains "a" and "c", the form <em>will</em> parse as <code>LenientForm&lt;T></code>.<p>You can use a <code>LenientForm</code> anywhere you'd use a <code>Form</code>. Its generic parameter is also required to implement <code>FromForm</code>. For instance, we can simply replace <code>Form</code> with <code>LenientForm</code> above to get lenient parsing:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>Task</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
<span class=cp>#[post(</span><span class=s>"/todo"</span><span class=cp>, data = </span><span class=s>"&lt;task>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>task</span>: <span class=nc>LenientForm</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><h5 id=field-renaming>Field Renaming<a class=headerlink href=#field-renaming title="perma link">#</a></h5><p>By default, Rocket matches the name of an incoming form field to the name of a structure field. While this behavior is typical, it may also be desired to use different names for form fields and struct fields while still parsing as expected. You can ask Rocket to look for a different form field for a given structure field by using the <code>#[form(field = "name")]</code> field annotation.<p>As an example, say that you're writing an application that receives data from an external service. The external service <code>POST</code>s a form with a field named <code>type</code>. Since <code>type</code> is a reserved keyword in Rust, it cannot be used as the name of a field. To get around this, you can use field renaming as follows:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>External</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=cp>#[form(field = </span><span class=s>"type"</span><span class=cp>)]</span><span class=w></span>
<span class=w>    </span><span class=n>api_type</span>: <span class=nb>String</span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>Rocket will then match the form field named <code>type</code> to the structure field named <code>api_type</code> automatically.<h5 id=field-validation>Field Validation<a class=headerlink href=#field-validation title="perma link">#</a></h5><p>Fields of forms can be easily validated via implementations of the <a href=../../index.html><code>FromFormValue</code></a> trait. For example, if you'd like to verify that some user is over some age in a form, then you might define a new <code>AdultAge</code> type, use it as a field in a form structure, and implement <code>FromFormValue</code> so that it only validates integers over that age:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div><td class=code><div class="code hl"><pre><span></span><span class=k>struct</span> <span class=nc>AdultAge</span><span class=p>(</span><span class=kt>usize</span><span class=p>);</span><span class=w></span>
<span class=k>impl</span><span class=o>&lt;</span><span class=na>'v</span><span class=o>></span><span class=w> </span><span class=n>FromFormValue</span><span class=o>&lt;</span><span class=na>'v</span><span class=o>></span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>AdultAge</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>type</span> <span class=nc>Error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&</span><span class=na>'v</span><span class=w> </span><span class=n>RawStr</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>fn</span> <span class=nf>from_form_value</span><span class=p>(</span><span class=n>form_value</span>: <span class=kp>&</span><span class=na>'v</span><span class=w> </span><span class=n>RawStr</span><span class=p>)</span><span class=w> </span>-> <span class=nb>Result</span><span class=o>&lt;</span><span class=n>AdultAge</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=na>'v</span><span class=w> </span><span class=n>RawStr</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>form_value</span><span class=p>.</span><span class=n>parse</span>::<span class=o>&lt;</span><span class=kt>usize</span><span class=o>></span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=nb>Ok</span><span class=p>(</span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=mi>21</span><span class=w> </span><span class=o>=></span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>AdultAge</span><span class=p>(</span><span class=n>age</span><span class=p>)),</span><span class=w></span>
<span class=w>            </span><span class=n>_</span><span class=w> </span><span class=o>=></span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>form_value</span><span class=p>),</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>Person</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>age</span>: <span class=nc>AdultAge</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>If a form is submitted with a bad age, Rocket won't call a handler requiring a valid form for that structure. You can use <code>Option</code> or <code>Result</code> types for fields to catch parse failures:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(FromForm)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>Person</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>age</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>AdultAge</span><span class=o>></span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>The <code>FromFormValue</code> trait can also be derived for enums with nullary fields:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(FromFormValue)]</span><span class=w></span>
<span class=k>enum</span> <span class=nc>MyValue</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>First</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>Second</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>Third</span><span class=p>,</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>The derive generates an implementation of the <code>FromFormValue</code> trait for the decorated enum. The implementation returns successfully when the form value matches, case insensitively, the stringified version of a variant's name, returning an instance of said variant.<p>The <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/form_validation>form validation</a> and <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/form_kitchen_sink>form kitchen sink</a> examples provide further illustrations.<h4 id=json>JSON<a class=headerlink href=#json title="perma link">#</a></h4><p>Handling JSON data is no harder: simply use the <a href=../../index.html><code>Json</code></a> type from <a href=../../index.html ><code>rocket_contrib</code></a>:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[derive(Deserialize)]</span><span class=w></span>
<span class=k>struct</span> <span class=nc>Task</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>description</span>: <span class=nb>String</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>complete</span>: <span class=kt>bool</span>
<span class=p>}</span><span class=w></span>
<span class=cp>#[post(</span><span class=s>"/todo"</span><span class=cp>, data = </span><span class=s>"&lt;task>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>task</span>: <span class=nc>Json</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>></span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>The only condition is that the generic type in <code>Json</code> implements the <code>Deserialize</code> trait from <a href=https://github.com/serde-rs/json>Serde</a>. See the <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/json>JSON example</a> on GitHub for a complete example.<h4 id=streaming>Streaming<a class=headerlink href=#streaming title="perma link">#</a></h4><p>Sometimes you just want to handle incoming data directly. For example, you might want to stream the incoming data out to a file. Rocket makes this as simple as possible via the <a href=../../index.html><code>Data</code></a> type:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[post(</span><span class=s>"/upload"</span><span class=cp>, format = </span><span class=s>"plain"</span><span class=cp>, data = </span><span class=s>"&lt;data>"</span><span class=cp>)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>upload</span><span class=p>(</span><span class=n>data</span>: <span class=nc>Data</span><span class=p>)</span><span class=w> </span>-> <span class=nc>io</span>::<span class=nb>Result</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>></span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>data</span><span class=p>.</span><span class=n>stream_to_file</span><span class=p>(</span><span class=s>"/tmp/upload.txt"</span><span class=p>).</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>n</span><span class=o>|</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>The route above accepts any <code>POST</code> request to the <code>/upload</code> path with <code>Content-Type: text/plain</code> The incoming data is streamed out to <code>tmp/upload.txt</code>, and the number of bytes written is returned as a plain text response if the upload succeeds. If the upload fails, an error response is returned. The handler above is complete. It really is that simple! See the <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/raw_upload>GitHub example code</a> for the full crate.<div class="admonition warning"><span class=title><b>Warning:</b> You should <em>always</em> set limits when reading incoming data.</span><p>To prevent DoS attacks, you should limit the amount of data you're willing to accept. The <a href=https://doc.rust-lang.org/std/io/trait.Read.html#method.take><code>take()</code></a> reader adapter makes doing this easy: <code>data.open().take(LIMIT)</code>.</div><h3 id=error-catchers>Error Catchers<a class=headerlink href=#error-catchers title="perma link">#</a></h3><p>Routing may fail for a variety of reasons. These include:<ul><li>A guard fails.<li>A handler returns a <a href=../../v0-4/guide/responses.html#responder><code>Responder</code></a> that fails.<li>No routes matched.</ul><p>If any of these conditions occur, Rocket returns an error to the client. To do so, Rocket invokes the <em>catcher</em> corresponding to the error's status code. A catcher is like a route, except it only handles errors. Rocket provides default catchers for all of the standard HTTP error codes. To override a default catcher, or declare a catcher for a custom status code, use the <a href=../../index.html><code>catch</code></a> attribute, which takes a single integer corresponding to the HTTP status code to catch. For instance, to declare a catcher for <code>404 Not Found</code> errors, you'd write:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[catch(404)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>not_found</span><span class=p>(</span><span class=n>req</span>: <span class=kp>&</span><span class=nc>Request</span><span class=p>)</span><span class=w> </span>-> <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>..</span><span class=w> </span><span class=p>}</span><span class=w></span>
</pre></div></table><p>As with routes, the return type (here <code>T</code>) must implement <code>Responder</code>. A concrete implementation may look like:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class="code hl"><pre><span></span><span class=cp>#[catch(404)]</span><span class=w></span>
<span class=k>fn</span> <span class=nf>not_found</span><span class=p>(</span><span class=n>req</span>: <span class=kp>&</span><span class=nc>Request</span><span class=p>)</span><span class=w> </span>-> <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>format</span><span class=o>!</span><span class=p>(</span><span class=s>"Sorry, '{}' is not a valid path."</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>.</span><span class=n>uri</span><span class=p>())</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div></table><p>Also as with routes, Rocket needs to know about a catcher before it is used to handle errors. The process, known as "registering" a catcher, is similar to mounting a route: call the <a href=../../index.html#method.register><code>register()</code></a> method with a list of catchers via the <a href=../../index.html><code>catchers!</code></a> macro. The invocation to add the <strong>404</strong> catcher declared above looks like:<table class="code hltable"><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class="code hl"><pre><span></span><span class=n>rocket</span>::<span class=n>ignite</span><span class=p>().</span><span class=n>register</span><span class=p>(</span><span class=n>catchers</span><span class=o>!</span><span class=p>[</span><span class=n>not_found</span><span class=p>])</span><span class=w></span>
</pre></div></table><p>Unlike route request handlers, catchers take exactly zero or one parameter. If the catcher takes a parameter, it must be of type <a href=../../index.html><code>&Request</code></a> The <a href=https://github.com/SergioBenitez/Rocket/tree/v0.4/examples/errors>error catcher example</a> on GitHub illustrates their use in full.<hr><div class=grid><div class=col style=float:left><a href=../../index.html>◄ Overview</a></div><div class="col text-right"><a href=../../v0-4/guide/responses.html style=margin-left:auto>Responses ►</a></div></div></article><div id=search-results style=display:none><div class=cancel-search onclick=cancelSearch()></div><span id=search-status></span><hr><br><div id=hits></div></div></section><footer class=grid><div class=container><div class="col mobile-hide"><a href=https://sergio.bz>© 2016-2019 Sergio Benitez</a></div><div class="col centered"><img src=../../v0-4/images/logo-small.svg alt="Small Rocket Logo"></div><div class="col text-right mobile-hide"><a href=#>BACK TO TOP Δ</a></div></div></footer><script src=../../ajax/libs/lunr-js/2-3-3/lunr.min.js charset=utf-8></script><script>function load_index(e,i,s){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(){if(200<=a.status&&a.status<400){var e=JSON.parse(a.responseText),n=lunr(function(){this.pipeline.reset(),this.pipeline.add(lunr.trimmer),this.field("title",{boost:10}),this.field("body"),this.ref("id");var n=this;e.documents.forEach(function(e){n.add(e)})}),t={};for(var o in e.documents){var r=e.documents[o];t[r.id]=r}i(n,t)}else s("error talking to server")},a.onerror=s,a.send()}function on_search_results(e,n,t){var o,r,i=!1;load_index(e,function(e,n){o=e,r=n,i=!0},function(){console.log("error loading index")});var s=document.getElementById(n);s.addEventListener("keyup",function(){if(i){var e=s.value.trim(),n=o.query(function(n){e.toLowerCase().split(" ").filter(Boolean).forEach(function(e){n.term(e,{wildcard:lunr.Query.wildcard.TRAILING})})}).map(function(e){return r[e.ref]});t(n)}else console.log("index not loaded. aborting search")})}</script><script>var searchBar = document.getElementById('search-input');
    var article = document.getElementsByTagName('article')[0];
    var searchResults = document.getElementById('search-results');
    var cancelButton = document.getElementById("cancel-search");
    var searchStatus = document.getElementById("search-status");
    var hitsDiv = document.getElementById("hits");
    var originalTitle = document.title;
    String.prototype.hashCode = function() {
      var hash = 0, i, chr;
      if (this.length === 0) return hash;
      for (i = 0; i < this.length; i++) {
          chr   = this.charCodeAt(i);
          hash  = ((hash << 5) - hash) + chr;
          hash |= 0; // Convert to 32bit integer
      }
      return hash;
    };
    function toggleResultsIfNecessary() {
      var query = escape(searchBar.value);
      if (query.length > 1) {
        article.style.display = "none";
        searchResults.style.display = "block";
        document.title = `Search for "${query}" - Rocket Programming Guide`;
        return true;
      } else {
        article.style.display = "block";
        searchResults.style.display = "none";
        document.title = originalTitle;
        return false;
      }
    }
    function cancelSearch() {
      searchBar.value = "";
      toggleResultsIfNecessary();
    }
    function escape(string) {
      var doc = new DOMParser().parseFromString(string, 'text/html');
      var stripped = doc.body.textContent || "";
      return stripped.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1").trim();
    }
    function replaceAll(text, query, replacement) {
      var space = new RegExp(lunr.tokenizer.separator, "igm");
      var find = escape(query).replace(space, "|");
      return text.replace(new RegExp(find, 'igm'), replacement);
    }
    function focus(body, query, length, highlight) {
      var space = new RegExp(lunr.tokenizer.separator, "igm");
      var find = escape(query).replace(space, "|");
      var index = body.search(new RegExp(find, 'igm'));
      if (index === -1) {
        return body.substring(0, length) + '..';
      } else {
        var r = body.substring(0, 50).hashCode() % (length / 8);
        var left = Math.max(index - (length / 8) - r, 0);
        var right = Math.min(body.length, left + length);
        var focused = body.substring(left, right).trim();
        var prefix = (left === 0) ? '' : '..';
        var suffix = (right === body.length) ? '' : '..';
        return prefix + focused.replace(new RegExp(find, 'igm'), highlight) + suffix;
      }
    }
    on_search_results("../../v0-4/js/search-index.js", "search-input", function(docs) {
      if (!toggleResultsIfNecessary()) {
        return;
      }
      hitsDiv.innerHTML = "";
      var query = escape(searchBar.value);
      if (docs.length == 0) {
        noResults = `<b>We didn't find any results for <em>"${query}"</em>.</b>`;
        searchStatus.innerHTML = noResults;
        return;
      }
      var top = `<b>Showing ${docs.length} results for <em>"${query}"</em>.</b>`;
      searchStatus.innerHTML = top;
      function highlight(token) {
        return `<em>${token}</em>`;
      }
      for (doc of docs) {
        var docTitle = replaceAll(doc.title, query, highlight);
        var hitHtml =
          `
            <div class="hit">
              <a href="../../guide/${doc.id}"><b>${docTitle}</b></a>
              <br />
              <span>${doc.breadcrumb}</span>
              <p class="hit-content">${focus(doc.body, query, 400, highlight)}</p>
            </div>
        `;
        hitsDiv.insertAdjacentHTML('beforeend', hitHtml);
      }
    })</script><script>function toggleOptions(){if(!(870<=screen.width)){var e=document.querySelector("nav.version-select options");e.style.display="none"===e.style.display?"block":"none"}}</script><script>!function(){var r=null,u=0,a=document.querySelector(".front.clouds"),c=document.querySelector(".back.clouds"),s=20,d=5;window.requestAnimationFrame(function e(n){if(r||(r=n),n-u<50)window.requestAnimationFrame(e);else{var o=n-r,t=s*(o/1e3),i=d*(o/1e3);a.style.backgroundPositionX=-t+"px",c.style.backgroundPositionX=-i+"px",u=n,window.requestAnimationFrame(e)}})}()</script>